<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium IPTV BD & IN</title>
    <!-- Tailwind CSS (‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HLS.js (‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶° */
        body { background-color: #0f172a; color: #e2e8f0; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        
        /* ‡¶ü‡¶ø‡¶≠‡¶ø ‡¶∞‡¶ø‡¶Æ‡ßã‡¶ü ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
        .focusable:focus {
            outline: 3px solid #eab308; /* ‡¶π‡¶≤‡ßÅ‡¶¶ ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶≤‡ßá */
            transform: scale(1.03);
            z-index: 50;
            background-color: #1e293b;
            box-shadow: 0 0 15px rgba(234, 179, 8, 0.6);
        }
        
        /* ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        .loader { border-top-color: #3b82f6; -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="h-screen w-screen flex flex-col select-none">

    <!-- ‡ßß. ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® (Login Screen) -->
    <div id="login-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900 bg-opacity-95">
        <div class="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-sm border border-slate-700 text-center">
            <i class="fas fa-tv text-5xl text-blue-500 mb-4"></i>
            <h2 class="text-2xl font-bold text-white mb-6">‡¶Ü‡¶á‡¶™‡¶ø‡¶ü‡¶ø‡¶≠‡¶ø ‡¶≤‡¶ó‡¶á‡¶®</h2>
            
            <input type="text" id="username" class="w-full bg-slate-700 text-white rounded p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focusable" placeholder="‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <input type="password" id="password" class="w-full bg-slate-700 text-white rounded p-3 mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500 focusable" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
            
            <button id="login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded transition focusable">
                ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <p id="login-error" class="text-red-500 text-sm mt-4 hidden">‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑!</p>
        </div>
    </div>

    <!-- ‡ß®. ‡¶Æ‡ßÇ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶´‡ßá‡¶∏ (Main App) -->
    <div id="app-interface" class="flex flex-col h-full hidden">
        
        <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <header class="bg-slate-900 border-b border-slate-800 p-3 flex justify-between items-center shadow-lg z-20">
            <div class="flex items-center gap-3">
                <i class="fas fa-satellite-dish text-yellow-400 text-2xl"></i>
                <h1 class="font-bold text-lg tracking-wide text-white">SMART TV <span class="text-xs text-blue-400">BD & IN</span></h1>
            </div>
            <div class="flex items-center gap-4">
                <span id="user-badge" class="text-xs bg-slate-800 text-green-400 px-2 py-1 rounded border border-slate-700">User</span>
                <button id="logout-btn" class="bg-red-600 text-white text-xs font-bold px-3 py-1 rounded focusable">
                    LOGOUT
                </button>
            </div>
        </header>

        <!-- ‡¶Æ‡ßá‡¶á‡¶® ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü (‡¶ü‡¶ø‡¶≠‡¶ø ‡¶ì ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶´‡ßç‡¶≤‡ßá‡¶ï‡ßç‡¶∏ ‡¶°‡¶ø‡¶∞‡ßá‡¶ï‡¶∂‡¶®) -->
        <div class="flex flex-1 overflow-hidden flex-col lg:flex-row">
            
            <!-- ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
            <div class="w-full lg:w-2/3 bg-black flex flex-col relative group order-1 lg:order-2">
                <div id="player-container" class="w-full h-full aspect-video lg:aspect-auto relative bg-black">
                    <video id="video" class="w-full h-full object-contain" controls crossorigin="anonymous"></video>
                    
                    <!-- ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ -->
                    <div id="loader" class="absolute inset-0 flex items-center justify-center bg-black z-10 hidden">
                        <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                    </div>
                </div>
                
                <!-- ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶á‡¶®‡¶´‡ßã -->
                <div class="p-3 bg-slate-900 border-t border-slate-800">
                    <h2 id="current-channel" class="text-lg font-bold text-yellow-400 truncate">Select a Channel</h2>
                    <div class="flex items-center gap-2 text-sm text-slate-400">
                        <span id="current-country" class="px-2 py-0.5 bg-slate-700 rounded text-xs text-white">Country</span>
                        <span id="current-category">Category</span>
                    </div>
                </div>
            </div>

            <!-- ‡¶∏‡¶æ‡¶á‡¶°‡¶¨‡¶æ‡¶∞: ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶ì ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
            <div class="w-full lg:w-1/3 bg-slate-900 flex flex-col min-h-0 border-r border-slate-800 order-2 lg:order-1">
                
                <!-- ‡¶ï‡¶æ‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
                <div class="flex p-2 gap-2 bg-slate-900 border-b border-slate-800">
                    <button onclick="filterByCountry('All')" class="country-btn flex-1 bg-blue-600 text-white py-2 rounded text-sm font-bold focusable" data-c="All">All</button>
                    <button onclick="filterByCountry('BD')" class="country-btn flex-1 bg-slate-800 text-slate-300 py-2 rounded text-sm font-bold focusable" data-c="BD">BD üáßüá©</button>
                    <button onclick="filterByCountry('IN')" class="country-btn flex-1 bg-slate-800 text-slate-300 py-2 rounded text-sm font-bold focusable" data-c="IN">IN üáÆüá≥</button>
                </div>

                <!-- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
                <div class="p-2 overflow-x-auto whitespace-nowrap no-scrollbar border-b border-slate-800" id="category-list">
                    <!-- Categories will load here -->
                </div>

                <!-- ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
                <div class="flex-1 overflow-y-auto p-2 grid grid-cols-1 gap-2 content-start no-scrollbar" id="channel-list">
                    <!-- Channels will load here -->
                    <div class="text-center text-slate-500 mt-10">Loading Channels...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================= ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® =================
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡¶ø‡¶ü‡¶π‡¶æ‡¶¨‡ßá‡¶∞ users.json ‡¶è‡¶∞ RAW ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶®
        // ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶æ‡¶§‡¶§ ‡¶°‡ßá‡¶Æ‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø, ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶≤‡ßá ‡¶ï‡ßã‡¶° ‡¶Ü‡¶®‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®‡•§
        // const USERS_DB_URL = 'https://raw.githubusercontent.com/YOUR_USERNAME/REPO/main/users.json'; 
        
        // ‡¶∏‡ßã‡¶∞‡ßç‡¶∏ ‡¶á‡¶â‡¶Ü‡¶∞‡¶è‡¶≤
        const SOURCES = [
            { url: 'https://iptv-org.github.io/iptv/countries/bd.m3u', country: 'BD' },
            { url: 'https://iptv-org.github.io/iptv/countries/in.m3u', country: 'IN' }
        ];

        // ================= ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ =================
        let allChannels = [];
        let displayedChannels = [];
        let categories = new Set();
        let currentCountryFilter = 'All';
        let currentCategoryFilter = 'All';
        let hls = null;

        // ================= ‡¶Ö‡¶•‡ßá‡¶®‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ =================
        const loginScreen = document.getElementById('login-screen');
        const appInterface = document.getElementById('app-interface');
        const loginBtn = document.getElementById('login-btn');
        const loginError = document.getElementById('login-error');

        function initAuth() {
            const user = JSON.parse(localStorage.getItem('iptv_user'));
            // ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ (‡¶∏‡¶ø‡¶Æ‡ßç‡¶™‡¶≤ ‡¶ö‡ßá‡¶ï)
            if (user && user.status === 'active') {
                showApp(user);
            } else {
                loginScreen.classList.remove('hidden');
                document.getElementById('username').focus();
            }
        }

        async function attemptLogin() {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();
            
            loginBtn.innerText = '‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            
            try {
                // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶ø fetch(USERS_DB_URL) ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®
                // ‡¶°‡ßá‡¶Æ‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶ø ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø
                
                const mockUsers = [
                    { username: "rafid", password: "123", status: "active" },
                    { username: "test", password: "test", status: "active" }
                ];

                // ‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶≤‡¶æ‡¶á‡¶´‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®:
                // const res = await fetch(USERS_DB_URL);
                // const users = await res.json();
                const users = mockUsers; // For demo

                const foundUser = users.find(user => user.username === u && user.password === p);

                if (foundUser && foundUser.status === 'active') {
                    localStorage.setItem('iptv_user', JSON.stringify(foundUser));
                    showApp(foundUser);
                } else {
                    throw new Error('‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑');
                }
            } catch (e) {
                loginError.classList.remove('hidden');
                loginBtn.innerText = '‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®';
            }
        }

        function showApp(user) {
            loginScreen.classList.add('hidden');
            appInterface.classList.remove('hidden');
            document.getElementById('user-badge').innerText = user.username;
            loadAllPlaylists();
        }

        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('iptv_user');
            location.reload();
        });
        loginBtn.addEventListener('click', attemptLogin);

        // ================= ‡¶™‡ßç‡¶≤‡ßá‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï =================
        async function loadAllPlaylists() {
            try {
                // ‡¶¶‡ßÅ‡¶á‡¶ü‡¶æ ‡¶∏‡ßã‡¶∞‡ßç‡¶∏ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶´‡ßá‡¶ö ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                const promises = SOURCES.map(src => fetch(src.url).then(r => r.text()).then(data => ({ data, country: src.country })));
                const results = await Promise.all(promises);
                
                results.forEach(result => parseM3U(result.data, result.country));
                
                // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
                updateUI();
                
            } catch (e) {
                console.error("‡¶™‡ßç‡¶≤‡ßá‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá:", e);
            }
        }

        function parseM3U(data, countryCode) {
            const lines = data.split('\n');
            let currentInfo = {};

            for (let line of lines) {
                line = line.trim();
                if (line.startsWith('#EXTINF:')) {
                    const groupMatch = line.match(/group-title="([^"]*)"/);
                    const logoMatch = line.match(/tvg-logo="([^"]*)"/);
                    
                    const group = groupMatch ? groupMatch[1] : 'Others';
                    const logo = logoMatch ? logoMatch[1] : null;
                    const name = line.split(',').pop().trim();

                    currentInfo = { name, group, logo, country: countryCode };
                } else if (line.startsWith('http')) {
                    // ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶è‡¶¨‡¶Ç ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡¶æ
                    allChannels.push({
                        ...currentInfo,
                        url: line
                    });
                    categories.add(group);
                }
            }
        }

        function updateUI() {
            renderCategories();
            filterChannels();
        }

        // ================= ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï =================
        function filterByCountry(country) {
            currentCountryFilter = country;
            // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            document.querySelectorAll('.country-btn').forEach(btn => {
                if(btn.dataset.c === country) {
                    btn.classList.replace('bg-slate-800', 'bg-blue-600');
                    btn.classList.replace('text-slate-300', 'text-white');
                } else {
                    btn.classList.replace('bg-blue-600', 'bg-slate-800');
                    btn.classList.replace('text-white', 'text-slate-300');
                }
            });
            filterChannels();
        }

        function filterByCategory(cat) {
            currentCategoryFilter = cat;
            // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶π‡¶æ‡¶á‡¶≤‡¶æ‡¶á‡¶ü
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('bg-yellow-500', 'text-black');
                btn.classList.add('bg-slate-700', 'text-slate-300');
                if(btn.innerText === cat) {
                    btn.classList.remove('bg-slate-700', 'text-slate-300');
                    btn.classList.add('bg-yellow-500', 'text-black');
                }
            });
            filterChannels();
        }

        function filterChannels() {
            const list = document.getElementById('channel-list');
            list.innerHTML = '';

            // ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï
            let filtered = allChannels;
            
            if (currentCountryFilter !== 'All') {
                filtered = filtered.filter(c => c.country === currentCountryFilter);
            }
            
            // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá, ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ï‡¶æ‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∞‡¶ø-‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶â‡¶ö‡¶ø‡¶§ (Advanced UX), 
            // ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶∏‡¶π‡¶ú‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶õ‡¶ø‡•§
            
            if (currentCategoryFilter !== 'All') {
                filtered = filtered.filter(c => c.group === currentCategoryFilter);
            }

            // ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ø‡¶Ç
            if(filtered.length === 0) {
                list.innerHTML = '<div class="text-center text-slate-500 p-4">‡¶ï‡ßã‡¶® ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</div>';
                return;
            }

            filtered.forEach(ch => {
                const el = document.createElement('div');
                el.className = 'focusable bg-slate-800 p-3 rounded flex items-center gap-3 cursor-pointer hover:bg-slate-700 transition border border-transparent mb-1';
                el.tabIndex = 0; 
                
                const img = ch.logo ? 
                    `<img src="${ch.logo}" class="w-10 h-10 object-contain bg-black rounded p-1" onerror="this.src='https://via.placeholder.com/40?text=TV'">` : 
                    `<div class="w-10 h-10 bg-slate-700 rounded flex items-center justify-center text-slate-500"><i class="fas fa-tv"></i></div>`;

                el.innerHTML = `
                    ${img}
                    <div class="overflow-hidden">
                        <h3 class="font-bold text-sm truncate text-white">${ch.name}</h3>
                        <p class="text-xs text-slate-500 truncate flex items-center gap-2">
                            <span class="bg-slate-900 px-1 rounded">${ch.country}</span> ${ch.group}
                        </p>
                    </div>
                `;
                
                el.onclick = () => playChannel(ch);
                el.onkeydown = (e) => { if(e.key === 'Enter') playChannel(ch); };

                list.appendChild(el);
            });
        }

        function renderCategories() {
            const catContainer = document.getElementById('category-list');
            catContainer.innerHTML = '';
            
            // "All" Button
            const allBtn = createCatBtn('All', true);
            catContainer.appendChild(allBtn);

            Array.from(categories).sort().forEach(cat => {
                catContainer.appendChild(createCatBtn(cat, false));
            });
        }

        function createCatBtn(text, isActive) {
            const btn = document.createElement('button');
            btn.className = `cat-btn px-4 py-1 mr-2 rounded text-sm font-semibold transition focusable whitespace-nowrap ${isActive ? 'bg-yellow-500 text-black' : 'bg-slate-700 text-slate-300'}`;
            btn.innerText = text;
            btn.onclick = () => filterByCategory(text);
            return btn;
        }

        // ================= ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ =================
        function playChannel(channel) {
            const video = document.getElementById('video');
            const loader = document.getElementById('loader');
            
            // UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            document.getElementById('current-channel').innerText = channel.name;
            document.getElementById('current-country').innerText = channel.country;
            document.getElementById('current-category').innerText = channel.group;
            
            loader.classList.remove('hidden');

            if (Hls.isSupported()) {
                if(hls) hls.destroy();
                hls = new Hls();
                hls.loadSource(channel.url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    loader.classList.add('hidden');
                    video.play();
                });
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                         loader.classList.add('hidden');
                         // ‡¶è‡¶∞‡¶∞ ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç (‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡ßü ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶¨‡¶æ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú)
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = channel.url;
                video.addEventListener('loadedmetadata', () => {
                    loader.classList.add('hidden');
                    video.play();
                });
            }
        }

        // ================= ‡¶ï‡¶ø-‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® (TV Remote) =================
        document.addEventListener('keydown', (e) => {
            const focusables = Array.from(document.querySelectorAll('.focusable'));
            const index = focusables.indexOf(document.activeElement);
            
            if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                e.preventDefault();
                const next = focusables[index + 1] || focusables[0];
                if(next) next.focus();
            } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                e.preventDefault();
                const prev = focusables[index - 1] || focusables[focusables.length - 1];
                if(prev) prev.focus();
            }
        });

        // ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ï
        initAuth();

    </script>
</body>
</html>

